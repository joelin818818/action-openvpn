# 🚀 1Panel + OpenVPN 远程管理工作流

这个GitHub Actions工作流用于在Ubuntu最新版本上自动化完成以下任务:

1. 🖥️ 安装1Panel服务器管理面板
2. 🔒 通过OpenVPN连接到您的服务器网络
3. 🔄 持续保持OpenVPN连接并自动每10分钟重新触发检查

## ✨ 工作流特点

- **🛡️ 安全远程访问**：通过VPN加密通道安全地访问1Panel控制台
- **🤖 完全自动化**：整个安装和连接过程不需要人工干预
- **🔌 便捷服务器管理**：无需公网IP或端口转发即可管理您的服务器
- **♾️ 无限期运行**：通过自动重新触发机制，可以无限期保持VPN连接
- **📊 循环监控**：每10分钟自动检查一次OpenVPN连接状态

## 🎯 应用场景

- 🏢 管理内网或防火墙后的服务器
- 🛑 在不暴露管理界面到公网的情况下远程管理服务器
- 🏠 在家办公时安全地访问公司服务器
- 👥 为多个管理员提供安全的远程访问方式
- ⏱️ 需要长时间保持VPN连接的自动化任务

## 🔧 配置方法

### 📋 前提条件

- GitHub账户
- OpenVPN服务器及其配置文件(.ovpn)
- 需要安装1Panel的目标服务器

### 📝 设置步骤

1. **添加OpenVPN配置到仓库Secrets** 🔐
   
   将您的OpenVPN配置文件内容添加到仓库的Secrets中，命名为`OPENVPN_CONFIG`。
   
   路径：仓库 → Settings → Secrets and variables → Actions → New repository secret

2. **自定义工作流(可选)** ⚙️

   如果需要，您可以修改`ubuntu_openvpn.yml`文件来：
   - 调整VPN连接参数
   - 指向不同的1Panel安装源
   - 修改循环检查间隔（默认为10分钟）

## 📋 使用方法

> 🟢 **只需启动一次，自动循环运行**

工作流配置为手动触发，您只需启动一次，后续会自动循环运行：

1. 在GitHub仓库页面，点击"Actions"标签
2. 选择"在最新Ubuntu上运行脚本并循环检查网络 (通过OpenVPN)"工作流
3. 点击"Run workflow"按钮
4. 确认并启动工作流

启动后工作流会：
- 第一次运行：执行完整流程（安装1Panel + 启动OpenVPN + 等待10分钟）
- 后续循环：只执行等待和检查步骤，每10分钟触发一次新的运行

## 🔄 工作流详解

### 🔢 初始运行流程（第1次运行）

1. **📥 检出代码**：检出仓库代码以准备执行后续步骤
2. **🔌 启动OpenVPN守护进程**：配置并启动OpenVPN客户端，建立与您服务器的安全连接
3. **📦 下载并安装1Panel**：安装1Panel服务器管理面板
4. **⏱️ 等待10分钟**：等待10分钟后自动触发下一次检查
5. **🔄 触发下一次循环**：自动启动新的工作流实例进行下一轮检查

### 🔁 循环运行流程（第2次及以后）

1. **📊 恢复OpenVPN状态**：显示当前循环次数和继续监控的OpenVPN进程
2. **⏱️ 等待10分钟**：检查OpenVPN进程是否仍在运行
3. **🔄 触发下一次循环**：如果OpenVPN仍在运行，自动触发新的循环

## ⚠️ 故障排除

- **🔴 无法启动OpenVPN**：检查OpenVPN配置是否正确，确认VPN服务器能正常分配IP
- **🔴 安装1Panel失败**：查看安装日志确认服务器环境是否满足要求
- **🔴 循环中断**：如果循环意外停止，您可以手动重新启动工作流

## 🛡️ 安全建议

> ⚠️ **安全警告：请务必遵循以下安全建议**

- 🔒 使用强密码保护您的1Panel控制台
- 🔄 定期更新OpenVPN配置以提高安全性
- 🛑 不需要时手动停止所有运行中的工作流实例
- 🔍 定期检查GitHub Actions使用情况，避免超出配额

## 📊 监控和管理

工作流设计为自我循环运行，您可以通过以下方式监控和管理：

- **查看所有运行**：在Actions选项卡中查看所有工作流运行实例
- **查看循环次数**：每次运行会显示当前是第几轮循环
- **手动终止**：通过点击"Cancel workflow"按钮可以终止当前运行
- **完全停止**：要完全停止，需要取消所有正在运行的实例

---

**📢 注意**: 此工作流通过自动触发新实例来实现持续运行，每个实例会运行约10分钟。请记住在不需要时手动停止所有运行实例，以避免不必要地消耗GitHub Actions的运行时间配额。

